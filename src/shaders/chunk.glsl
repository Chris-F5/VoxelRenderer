#define NEIGHBOUR_EMPTY ~0
#define NEIGHBOUR_NEGATIVE_X 0
#define NEIGHBOUR_NEGATIVE_Y 1
#define NEIGHBOUR_NEGATIVE_Z 2
#define NEIGHBOUR_POSITIVE_X 3
#define NEIGHBOUR_POSITIVE_Y 4
#define NEIGHBOUR_POSITIVE_Z 5

const vec3 normalPalette[] = {
	vec3(-0.5773502691896258, -0.5773502691896258, -0.5773502691896258),
	vec3(-0.3333333333333333, -0.6666666666666666, -0.6666666666666666),
	vec3(0.0, -0.7071067811865475, -0.7071067811865475),
	vec3(0.3333333333333333, -0.6666666666666666, -0.6666666666666666),
	vec3(0.5773502691896258, -0.5773502691896258, -0.5773502691896258),
	vec3(-0.6666666666666666, -0.3333333333333333, -0.6666666666666666),
	vec3(-0.4082482904638631, -0.4082482904638631, -0.8164965809277261),
	vec3(0.0, -0.4472135954999579, -0.8944271909999159),
	vec3(0.4082482904638631, -0.4082482904638631, -0.8164965809277261),
	vec3(0.6666666666666666, -0.3333333333333333, -0.6666666666666666),
	vec3(-0.7071067811865475, 0.0, -0.7071067811865475),
	vec3(-0.4472135954999579, 0.0, -0.8944271909999159),
	vec3(0.0, 0.0, -1.0),
	vec3(0.4472135954999579, 0.0, -0.8944271909999159),
	vec3(0.7071067811865475, 0.0, -0.7071067811865475),
	vec3(-0.6666666666666666, 0.3333333333333333, -0.6666666666666666),
	vec3(-0.4082482904638631, 0.4082482904638631, -0.8164965809277261),
	vec3(0.0, 0.4472135954999579, -0.8944271909999159),
	vec3(0.4082482904638631, 0.4082482904638631, -0.8164965809277261),
	vec3(0.6666666666666666, 0.3333333333333333, -0.6666666666666666),
	vec3(-0.5773502691896258, 0.5773502691896258, -0.5773502691896258),
	vec3(-0.3333333333333333, 0.6666666666666666, -0.6666666666666666),
	vec3(0.0, 0.7071067811865475, -0.7071067811865475),
	vec3(0.3333333333333333, 0.6666666666666666, -0.6666666666666666),
	vec3(0.5773502691896258, 0.5773502691896258, -0.5773502691896258),
	vec3(-0.6666666666666666, -0.6666666666666666, -0.3333333333333333),
	vec3(-0.4082482904638631, -0.8164965809277261, -0.4082482904638631),
	vec3(0.0, -0.8944271909999159, -0.4472135954999579),
	vec3(0.4082482904638631, -0.8164965809277261, -0.4082482904638631),
	vec3(0.6666666666666666, -0.6666666666666666, -0.3333333333333333),
	vec3(-0.8164965809277261, -0.4082482904638631, -0.4082482904638631),
	vec3(-0.5773502691896258, -0.5773502691896258, -0.5773502691896258),
	vec3(0.0, -0.7071067811865475, -0.7071067811865475),
	vec3(0.5773502691896258, -0.5773502691896258, -0.5773502691896258),
	vec3(0.8164965809277261, -0.4082482904638631, -0.4082482904638631),
	vec3(-0.8944271909999159, 0.0, -0.4472135954999579),
	vec3(-0.7071067811865475, 0.0, -0.7071067811865475),
	vec3(0.0, 0.0, -1.0),
	vec3(0.7071067811865475, 0.0, -0.7071067811865475),
	vec3(0.8944271909999159, 0.0, -0.4472135954999579),
	vec3(-0.8164965809277261, 0.4082482904638631, -0.4082482904638631),
	vec3(-0.5773502691896258, 0.5773502691896258, -0.5773502691896258),
	vec3(0.0, 0.7071067811865475, -0.7071067811865475),
	vec3(0.5773502691896258, 0.5773502691896258, -0.5773502691896258),
	vec3(0.8164965809277261, 0.4082482904638631, -0.4082482904638631),
	vec3(-0.6666666666666666, 0.6666666666666666, -0.3333333333333333),
	vec3(-0.4082482904638631, 0.8164965809277261, -0.4082482904638631),
	vec3(0.0, 0.8944271909999159, -0.4472135954999579),
	vec3(0.4082482904638631, 0.8164965809277261, -0.4082482904638631),
	vec3(0.6666666666666666, 0.6666666666666666, -0.3333333333333333),
	vec3(-0.7071067811865475, -0.7071067811865475, 0.0),
	vec3(-0.4472135954999579, -0.8944271909999159, 0.0),
	vec3(0.0, -1.0, 0.0),
	vec3(0.4472135954999579, -0.8944271909999159, 0.0),
	vec3(0.7071067811865475, -0.7071067811865475, 0.0),
	vec3(-0.8944271909999159, -0.4472135954999579, 0.0),
	vec3(-0.7071067811865475, -0.7071067811865475, 0.0),
	vec3(0.0, -1.0, 0.0),
	vec3(0.7071067811865475, -0.7071067811865475, 0.0),
	vec3(0.8944271909999159, -0.4472135954999579, 0.0),
	vec3(-1.0, 0.0, 0.0),
	vec3(-1.0, 0.0, 0.0),
	vec3(0, 0, 0),
	vec3(1.0, 0.0, 0.0),
	vec3(1.0, 0.0, 0.0),
	vec3(-0.8944271909999159, 0.4472135954999579, 0.0),
	vec3(-0.7071067811865475, 0.7071067811865475, 0.0),
	vec3(0.0, 1.0, 0.0),
	vec3(0.7071067811865475, 0.7071067811865475, 0.0),
	vec3(0.8944271909999159, 0.4472135954999579, 0.0),
	vec3(-0.7071067811865475, 0.7071067811865475, 0.0),
	vec3(-0.4472135954999579, 0.8944271909999159, 0.0),
	vec3(0.0, 1.0, 0.0),
	vec3(0.4472135954999579, 0.8944271909999159, 0.0),
	vec3(0.7071067811865475, 0.7071067811865475, 0.0),
	vec3(-0.6666666666666666, -0.6666666666666666, 0.3333333333333333),
	vec3(-0.4082482904638631, -0.8164965809277261, 0.4082482904638631),
	vec3(0.0, -0.8944271909999159, 0.4472135954999579),
	vec3(0.4082482904638631, -0.8164965809277261, 0.4082482904638631),
	vec3(0.6666666666666666, -0.6666666666666666, 0.3333333333333333),
	vec3(-0.8164965809277261, -0.4082482904638631, 0.4082482904638631),
	vec3(-0.5773502691896258, -0.5773502691896258, 0.5773502691896258),
	vec3(0.0, -0.7071067811865475, 0.7071067811865475),
	vec3(0.5773502691896258, -0.5773502691896258, 0.5773502691896258),
	vec3(0.8164965809277261, -0.4082482904638631, 0.4082482904638631),
	vec3(-0.8944271909999159, 0.0, 0.4472135954999579),
	vec3(-0.7071067811865475, 0.0, 0.7071067811865475),
	vec3(0.0, 0.0, 1.0),
	vec3(0.7071067811865475, 0.0, 0.7071067811865475),
	vec3(0.8944271909999159, 0.0, 0.4472135954999579),
	vec3(-0.8164965809277261, 0.4082482904638631, 0.4082482904638631),
	vec3(-0.5773502691896258, 0.5773502691896258, 0.5773502691896258),
	vec3(0.0, 0.7071067811865475, 0.7071067811865475),
	vec3(0.5773502691896258, 0.5773502691896258, 0.5773502691896258),
	vec3(0.8164965809277261, 0.4082482904638631, 0.4082482904638631),
	vec3(-0.6666666666666666, 0.6666666666666666, 0.3333333333333333),
	vec3(-0.4082482904638631, 0.8164965809277261, 0.4082482904638631),
	vec3(0.0, 0.8944271909999159, 0.4472135954999579),
	vec3(0.4082482904638631, 0.8164965809277261, 0.4082482904638631),
	vec3(0.6666666666666666, 0.6666666666666666, 0.3333333333333333),
	vec3(-0.5773502691896258, -0.5773502691896258, 0.5773502691896258),
	vec3(-0.3333333333333333, -0.6666666666666666, 0.6666666666666666),
	vec3(0.0, -0.7071067811865475, 0.7071067811865475),
	vec3(0.3333333333333333, -0.6666666666666666, 0.6666666666666666),
	vec3(0.5773502691896258, -0.5773502691896258, 0.5773502691896258),
	vec3(-0.6666666666666666, -0.3333333333333333, 0.6666666666666666),
	vec3(-0.4082482904638631, -0.4082482904638631, 0.8164965809277261),
	vec3(0.0, -0.4472135954999579, 0.8944271909999159),
	vec3(0.4082482904638631, -0.4082482904638631, 0.8164965809277261),
	vec3(0.6666666666666666, -0.3333333333333333, 0.6666666666666666),
	vec3(-0.7071067811865475, 0.0, 0.7071067811865475),
	vec3(-0.4472135954999579, 0.0, 0.8944271909999159),
	vec3(0.0, 0.0, 1.0),
	vec3(0.4472135954999579, 0.0, 0.8944271909999159),
	vec3(0.7071067811865475, 0.0, 0.7071067811865475),
	vec3(-0.6666666666666666, 0.3333333333333333, 0.6666666666666666),
	vec3(-0.4082482904638631, 0.4082482904638631, 0.8164965809277261),
	vec3(0.0, 0.4472135954999579, 0.8944271909999159),
	vec3(0.4082482904638631, 0.4082482904638631, 0.8164965809277261),
	vec3(0.6666666666666666, 0.3333333333333333, 0.6666666666666666),
	vec3(-0.5773502691896258, 0.5773502691896258, 0.5773502691896258),
	vec3(-0.3333333333333333, 0.6666666666666666, 0.6666666666666666),
	vec3(0.0, 0.7071067811865475, 0.7071067811865475),
	vec3(0.3333333333333333, 0.6666666666666666, 0.6666666666666666),
	vec3(0.5773502691896258, 0.5773502691896258, 0.5773502691896258),
};

uint quantizeNormal(vec3 v)
{
    /* set magnitude to 2 */
    float m = sqrt(pow(v.x, 2) + pow(v.y, 2) + pow(v.z, 2));

    if (m == 0) {
        return 2 + 2 * 5 + 2 * 25;
    }

    v.x = v.x / m * 2;
    v.y = v.y / m * 2;
    v.z = v.z / m * 2;
    
    int x = int(round(v.x)) + 2;
    int y = int(round(v.y)) + 2;
    int z = int(round(v.z)) + 2;

    return x + y * 5 + z * 25;
}
